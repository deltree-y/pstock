# PStock - 基于LSTM的中国股票预测系统

## 项目简介

PStock是一个基于深度学习的中国股票价格趋势预测系统，使用双向LSTM神经网络对股票价格走势进行分类预测。该系统不预测具体价格，而是将未来价格变动分为不同的区间类别，提供投资参考。

## 核心功能

### 🔍 数据获取与处理
- **股票数据下载**: 通过Tushare API获取中国A股市场的实时和历史数据
- **技术指标计算**: 自动计算多种技术分析指标
- **数据预处理**: 包括数据清洗、归一化、窗口化处理
- **特征工程**: 从原始价格数据中提取有效的预测特征

### 🤖 机器学习模型
- **LSTM神经网络**: 采用双向LSTM架构，能够捕捉时间序列的长期依赖关系
- **分类预测**: 将连续的价格变动转换为离散的类别预测
- **多目标预测**: 同时预测T1L(短期低点)和T2H(中期高点)
- **模型优化**: 支持不同的epochs、batch size和网络参数调优

### 📊 预测分析
- **趋势分类**: 将价格变动划分为20个不同的类别区间
- **概率输出**: 提供各个类别的预测概率
- **风险评估**: 基于历史数据进行模型验证和风险评估

## 项目架构

### 系统架构图
```
数据层              处理层              模型层              预测层
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Tushare   │    │  特征工程   │    │   LSTM      │    │  结果处理   │
│   API       │ -> │  数据预处理 │ -> │   模型      │ -> │  分类预测   │
│   股票数据  │    │  归一化     │    │   训练      │    │  风险评估   │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
```

### 数据流程
1. **原始数据**: 从Tushare获取OHLCV数据
2. **特征工程**: 计算技术指标(MA, RSI, MACD等)
3. **数据预处理**: 归一化、窗口化、分箱
4. **模型训练**: 双向LSTM网络训练
5. **预测输出**: 分类概率 -> 价格区间预测

```
pstock/
├── datasets/           # 数据处理模块
│   ├── stock.py       # 单只股票数据管理
│   ├── stockinfo.py   # 股票基本信息
│   ├── trade.py       # 交易数据处理
│   ├── dataset.py     # 训练数据集构建
│   └── bins.py        # 数据分箱处理
├── model/             # 机器学习模型
│   ├── lstmmodel.py   # LSTM模型实现
│   └── history.py     # 训练历史记录
├── predicproc/        # 预测处理
│   └── predict.py     # 预测结果处理
├── utils/             # 工具函数
│   ├── const_def.py   # 常量定义
│   └── utils.py       # 通用工具函数
├── train.py           # 模型训练脚本
├── predict.py         # 预测执行脚本
└── download_filtered_data.py  # 数据下载脚本
```

## 主要模块说明

### 数据层 (datasets/)
- **Stock类**: 管理单只股票的历史数据，支持从Tushare API下载和本地缓存
- **StockInfo类**: 处理股票的基本信息，如名称、代码、所属行业等
- **Trade类**: 计算技术指标，包括移动平均线、成交量指标等
- **StockDataset类**: 构建机器学习所需的训练和测试数据集

### 模型层 (model/)
- **LSTMModel类**: 实现双向LSTM神经网络，支持多层结构和正则化
- **训练优化**: 包含学习率调度、早停机制、模型检查点保存

### 预测层 (predicproc/)
- **Predict类**: 处理模型输出，将概率转换为具体的价格区间预测
- **结果解释**: 提供预测的最小值、平均值、最大值及对应的价格

## 使用方法

### 1. 数据准备
```bash
# 下载指定市值以上的股票数据
python download_filtered_data.py -sd 20240101 -ed 20241201 -mmv 5000000
```

### 2. 模型训练
```bash
# 训练LSTM模型
python train.py
```

### 3. 预测执行
```bash
# 使用训练好的模型进行预测
python predict.py
```

## 配置说明

### 主要参数配置 (utils/const_def.py)
- `NUM_CLASSES = 20`: 预测类别数量
- `CONTINUOUS_DAYS = 25`: 输入序列长度
- `TOKEN`: Tushare API访问令牌
- `REL_CODE_LIST`: 相关股票代码列表

### 预测目标
- **T1L (T1 Low)**: 预测未来短期的最低价格变动幅度
- **T2H (T2 High)**: 预测未来中期的最高价格变动幅度

## 安装和配置

### 环境要求
- Python 3.7+
- 8GB+ RAM (推荐)
- GPU支持 (可选，用于加速训练)

### 安装依赖
```bash
# 克隆项目
git clone https://github.com/deltree-y/pstock.git
cd pstock

# 安装依赖
pip install -r requirements.txt
```

### 配置Tushare API
1. 注册Tushare账号: https://tushare.pro/register
2. 获取API Token
3. 在 `utils/const_def.py` 中设置您的Token:
```python
TOKEN = 'your_tushare_token_here'
```

### 快速开始
```bash
# 运行示例程序
python example.py

# 或者按照以下步骤
# 1. 下载数据
python download_filtered_data.py

# 2. 训练模型
python train.py

# 3. 进行预测
python predict.py
```

## 注意事项

⚠️ **重要提示**: 
- 本系统仅供学习和研究使用，不构成投资建议
- 股票投资存在风险，过往表现不代表未来结果
- 请在充分了解风险的前提下理性投资

📊 **数据质量**:
- 需要稳定的网络连接访问Tushare API
- 建议使用至少3年的历史数据进行训练
- 数据缺失可能影响预测准确性

🔧 **技术限制**:
- 模型预测结果为分类概率，不是精确价格
- 需要定期重新训练以适应市场变化
- GPU加速可显著提升训练速度

💡 **使用建议**:
- 结合多种技术指标和基本面分析
- 建议设置止损和止盈策略
- 定期评估和调整模型参数

## 项目状态

- ✅ 核心功能完整
- ✅ 数据获取和处理稳定  
- ✅ LSTM模型训练可用
- ✅ 预测功能正常
- 🔄 持续优化中

## 更新日志

### v1.0.0 (2024-12)
- 完成基础架构搭建
- 实现LSTM预测模型
- 添加完整文档和示例

## 贡献指南

欢迎提交Issue和Pull Request来改进这个项目！

## 许可证

本项目仅用于学习和研究目的。